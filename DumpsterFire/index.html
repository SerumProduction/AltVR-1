<!DOCTYPE html>
<html>
<head>
  <title>DumpsterFire</title>
  <script src="https://aframe.io/releases/0.3.0/aframe.js"></script>
  <!--<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.min.js"></script>-->
  <script src="https://sdk.altvr.com/libs/altspace.js/2.6.2/altspace.min.js"></script>
</head>
<body>
  <a-scene altspace='fullspace: true'>
    <!-- <a-box></a-box> -->
    <a-entity position='4 0 -54' rotation='0 180 0'>
      <a-entity id='model' position='0 0 0' scale='7 7 7' obj-model='obj: url(Alley.obj)' n-mesh-collider='type: environment; convex: false'></a-entity>
    </a-entity>
  </a-scene>
  <script>

    model.addEventListener('model-loaded', function(){
      var obj = model.object3D.children[0];
      console.log(obj);
      for (var i = 0; i < obj.children.length; i++) {
        obj.children[i].material = obj.children[i].material.clone();
        switch (obj.children[i].name) {
          case 'road1':
            applyTextures(obj.children[i], 'road.jpg', 35, 50, 0.42, 0, 'LightMap.jpg', 1);
            break;
          case 'road2':
            applyTextures(obj.children[i], 'road.jpg', 35, 50, 0.55, 0, 'LightMap.jpg', 1);
            break;
          case 'road3':
            applyTextures(obj.children[i], 'road.jpg', 35, 50, 0.76, 0, 'LightMap.jpg', 1);
            break;
          case 'road4':
            applyTextures(obj.children[i], 'road.jpg', 35, 50, 0.67, 0, 'LightMap.jpg', 1);
            break;
          case 'road5':
            applyTextures(obj.children[i], 'road.jpg', 35, 50, 0.48, 0, 'LightMap.jpg', 1);
            break;
          case 'road6':
            applyTextures(obj.children[i], 'road.jpg', 35, 50, 0.59, 0, 'LightMap.jpg', 1);
            break;
          case 'road7':
            applyTextures(obj.children[i], 'road.jpg', 35, 50, 0.76, 0, 'LightMap.jpg', 1);
            break;
          case 'road8':
            applyTextures(obj.children[i], 'road.jpg', 35, 50, 0.67, 0, 'LightMap.jpg', 1);
            break;

          case 'sidewalk':
            applyTextures(obj.children[i], 'sidewalk.jpg', 80, 80, 0, 0, 'LightMap.jpg', 1);
            break;
          case 'alley':
            applyTextures(obj.children[i], 'alley.jpg', 80, 80, 0, 0, 'LightMap.jpg', 1);
            break;

          default:
            obj.children[i].material.lightMap = THREE.ImageUtils.loadTexture('LightMap.jpg');
            break;
        }
      }

      function applyTextures(mesh, texture, wrapX, wrapY, offsetX, offsetY, lightmap, i) {
        mesh.material.map = THREE.ImageUtils.loadTexture('textures/' + texture);
        mesh.material.map.wrapS = mesh.material.map.wrapT = THREE.RepeatWrapping;
        mesh.material.map.repeat.set(wrapX, wrapY);
        mesh.material.map.offset.set(offsetX, offsetY);
        mesh.material.lightMap = THREE.ImageUtils.loadTexture(lightmap);
        mesh.material.lightMapIntensity = i;
        mesh.material.color.set(new THREE.Color(1,1,1));
        //mesh.addBehaviors(
           //new altspaceutil.behaviors.NativeComponent('n-mesh-collider', { convex: false, type: 'environment' })
        //);

        console.log(mesh.name, mesh.material.map);
      }
    });

  </script>
</body>
</html>